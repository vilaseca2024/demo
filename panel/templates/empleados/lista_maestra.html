{% extends 'menu.html' %}

{% block content %}
<div class="page-title">
    <div class="col-md-12 mx-3">
        <h3>Datos de Empleados</h3>
        <br>
    </div>
</div>

<div class="col-md-12 col-sm-12 ">
    <div class="x_panel">
        <div class="x_title">
            <h2>Listado de Empleados</h2>
            <ul class="nav navbar-right panel_toolbox">
                <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i
                            class="fa fa-wrench"></i></a>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                        <a class="dropdown-item" href="#">Settings 1</a>
                        <a class="dropdown-item" href="#">Settings 2</a>
                    </div>
                </li>
                <li><a class="close-link"><i class="fa fa-close"></i></a></li>
            </ul>
            <div class="clearfix"></div>
        </div>
        
        <div class="x_content">
            <div class="row">
                <div class="col-sm-12">
                    <div class="card-box table-responsive">
                        <table id="datatable-responsive" class="table table-striped table-bordered dt-responsive nowrap dataTable no-footer dtr-inline collapsed" cellspacing="0" width="100%" role="grid" aria-describedby="datatable-responsive_info" style="width: 100%;">
                            <thead>
                                <tr class="text-center">
                                    <th>#</th>
                                    <th>Código</th>
                                    <th>Nombre</th>
                                    <th>1er Apellido</th>
                                    <th>2do Apellido</th>
                                    <th>Fecha de Nac.</th>
                                    <th>Correo</th>
                                    <th>Género</th>
                                    <th>Activo</th>
                                    
                                    <th>Opciones</th>
                                    <th>Nombre Completo</th>
                                    <th>Estado Civil</th>
                                    
                                    <th>Tipo de Sangre</th>
                                    <th>Alergias</th>
                                    <th>Edad</th>
                                    <th>Generación</th>
                                    <th>Grupo</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if empleados_info %}
                                    {% for dato in empleados_info %}
                                        <tr>
                                            <td class="text-center">{{ forloop.counter }}</td>
                                            <td class="text-center">
                                                
                                                {% if dato.empleado.ci %}
                                                    {{ dato.empleado.ci }}{{ dato.empleado.expedido }}
                                                {% else %}
                                                    <a data-toggle="tooltip" data-placement="top" title="" 
                                                    data-original-title="Datos aun no cargados por el empleado {{dato.empleado.empleado_id.first_name}} {{dato.empleado.empleado_id.last_name}}">
                                                        <li class="fa fa-exclamation-triangle fa-2x" style="color: orange;"></li> 
                                                    </a>
                                                {% endif %}
                                            </td>
                                            <td class="text-center">
                                               
                                                {% if dato.empleado.nombre %}
                                                    {{ dato.empleado.nombre }}
                                                {% else %}
                                                    <a data-toggle="tooltip" data-placement="top" title="" 
                                                    data-original-title="Datos aun no cargados por el empleado {{dato.empleado.empleado_id.first_name}} {{dato.empleado.empleado_id.last_name}}">
                                                        <li class="fa fa-exclamation-triangle fa-2x" style="color: orange;"></li> 
                                                    </a>
                                                {% endif %}
                                            </td>
                                            <td class="text-center">
                                               
                                                {% if dato.empleado.ap_paterno %}
                                                    {{ dato.empleado.ap_paterno }}
                                                {% else %}
                                                    <a data-toggle="tooltip" data-placement="top" title="" 
                                                    data-original-title="Datos aun no cargados por el empleado {{dato.empleado.empleado_id.first_name}} {{dato.empleado.empleado_id.last_name}}">
                                                        <li class="fa fa-exclamation-triangle fa-2x" style="color: orange;"></li> 
                                                    </a>
                                                {% endif %}
                                            </td>
                                            <td class="text-center">
                                               
                                            {% if dato.empleado.ap_materno %}
                                            {{ dato.empleado.ap_materno }}
                                            {% else %}
                                                <a data-toggle="tooltip" data-placement="top" title="" 
                                                data-original-title="Datos aun no cargados por el empleado {{dato.empleado.empleado_id.first_name}} {{dato.empleado.empleado_id.last_name}}">
                                                    <li class="fa fa-exclamation-triangle fa-2x" style="color: orange;"></li> 
                                                </a>
                                            {% endif %}
                                                
                                            </td>
                                            <td class="text-center">
                                         
                                                {% if dato.empleado.fecha_nacimiento %}
                                                {{ dato.empleado.fecha_nacimiento }}
                                                    {% else %}
                                                        <a data-toggle="tooltip" data-placement="top" title="" 
                                                        data-original-title="Datos aun no cargados por el empleado {{dato.empleado.empleado_id.first_name}} {{dato.empleado.empleado_id.last_name}}">
                                                            <li class="fa fa-exclamation-triangle fa-2x" style="color: orange;"></li> 
                                                        </a>
                                                    {% endif %}
                                                
                                            </td>
                                            <td class="text-center">
                                                {{ dato.empleado.empleado_id.email }}
                                                
                                            </td>
                                            <td class="text-center">{{ dato.empleado.genero.genero }}</td>
                                            <td class="text-center">
                                                {% if dato.empleado.activo %}
                                                    <li class="fa fa-check fa-2x" style="color: blue;"></li>
                                                {% else %}
                                                    <li class="fa fa-times fa-2x" style="color: red;"></li>
                                                {% endif %}
                                            </td>
                                            
                                            <td class="text-center">
                                                <button class="btn btn-success btn-sm" 
                                                        data-toggle="modal" 
                                                        data-target="#editModal"
                                                        data-id="{{ dato.empleado.id_datos }}"  >
                                                    <li class="fa fa-edit"></li>  
                                                </button>
                                                <!-- <button class="btn btn-danger btn-sm" data-toggle="modal" data-target=".bs-example-modal-sm-show-{{ dato.id_certificado }}">
                                                    <li class="fa fa-trash"></li>
                                                </button> -->
                                            </td>
                                            <td class="text-center">
                                               
                                                {% if dato.empleado.nombre %}
                                                {{ dato.empleado.nombre }} {{ dato.empleado.ap_paterno }} {{ dato.empleado.ap_materno }}
                                                    {% else %}
                                                        
                                                        <li class="fa fa-exclamation-triangle" style="color: orange;"></li> 
                                                       
                                                    {% endif %}
                                            </td>
                                            <td class="text-center">
                                                
                                                {% if dato.empleado.estado_civil.estado %}
                                                {{ dato.empleado.estado_civil.estado }}
                                                    {% else %}
                                                        
                                                        <li class="fa fa-exclamation-triangle" style="color: orange;"></li> 
                                                       
                                                    {% endif %}
                                            </td>
                                            
                                            <td class="text-center">{{ dato.empleado.tipo_sangre }}</td>
                                            <td class="text-center">{{ dato.empleado.alergias }}</td>
                                            <td class="text-center">{{ dato.edad }}</td>
                                            <td class="text-center">{{ dato.generacion }}</td>
                                            <td class="text-center">{{ dato.clasificacion_grupo }}</td>
                                        </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr>
                                        <td colspan="17" class="text-center">No hay empleados registrados.</td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>




 
<div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editModalLabel">Editar Datos de Empleado</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form action="actualizar_datos_contactos" method="POST" id="editForm">
                {% csrf_token %}
                <div class="modal-body">
                    <!-- Campos del formulario -->
                    <div class="item form-group">
                        <label class="col-form-label col-md-3 col-sm-3 label-align" for="nombre">Nombre(s) <span
                                class="required">*</span>
                        </label>
                        <div class="col-md-8 col-sm-8 ">
                            <input type="hidden" id="id_certificado_editar" name="id_certificado_editar" required="required"
                                class="form-control " >

                            <input type="text" id="nombres" name="nombres" required="required" class="form-control "
                                >
                        </div>
                    </div>
                    <div class="item form-group">
                        <label for="gestion" class="col-form-label col-md-3 col-sm-3 label-align">Apellido Paterno</label>
                        <div class="col-md-3 col-sm-3">
                            <input type="text" id="ap_paterno_editar" name="ap_paterno_editar" required="required" class="form-control">
                        </div>
                        <label for="gestion" class="col-form-label col-md-2 col-sm-2 label-align">Apellido Materno</label>
                        <div class="col-md-3 col-sm-3">
                            <input type="text" id="ap_materno_editar" name="ap_materno_editar" required="required" class="form-control">
                        </div>
                   </div>
                   <div class="item form-group">
                    <label for="correo" class="col-form-label col-md-3 col-sm-3 label-align">Correo Electronico</label>
                    <div class="col-md-8 col-sm-8">
                        <input id="correo" name="correo" class="form-control" type="email" >
                    </div>
                </div>

                   
                    <div class="item form-group">
                        <label for="referencia" class="col-form-label col-md-3 col-sm-3 label-align">Carnet de Identidad</label>
                        <div class="col-md-3 col-sm-3">
                            <input id="carnet_editar" name="carnet_editar" class="form-control" type="text"  >
                            <input id="id_datos" name="id_datos" class="form-control" type="hidden"  >
                        </div>
                        <label for="referencia" class="col-form-label col-md-2 col-sm-2 label-align">Expedido</label>
                        <div class="col-md-3 col-sm-3">
                            
                            <select id="expedido_editar" name="expedido_editar" required="required" class="form-control">
                                <option value="">----</option>
                                <option value="LP">LP</option>
                                <option value="OR">OR</option>
                                <option value="SCZ">SCZ</option>
                                <option value="CBBA">CBBA</option>
                                <option value="PT">PT</option>
                                <option value="TJA">TJA</option>
                                <option value="CH">CH</option>
                                <option value="BE">BE</option>
                                <option value="PD">PD</option>
                              </select>
                        </div>
                    </div>

                    <div class="item form-group">
                        <label for="fecha_registro" class="col-form-label col-md-3 col-sm-3 label-align">Fecha de Nacimiento</label>
                        <div class="col-md-8 col-sm-8">
                            <input id="fecha_registro_editar" name="fecha_registro_editar" class="date-picker form-control" type="date" required>
                        </div>
                    </div>

                    <div class="item form-group">
                        <label for="estado" class="col-form-label col-md-3 col-sm-3 label-align">Estado Civil</label>
                        <div class="col-md-8 col-sm-8">
                            <select id="civil" name="civil" class="form-control">
                                <option value="">----</option>
                                {% for civil in civiles %}
                                    <option value="{{ civil.id_estado }}">{{ civil.estado }}</option>
                                {% endfor %}
                                
                            </select>
                        </div>
                    </div>

                    <div class="item form-group">
                        <label for="referencia" class="col-form-label col-md-3 col-sm-3 label-align">Genero</label>
                        <div class="col-md-8 col-sm-8">
                            <select id="genero_editar" name="genero_editar" class="form-control">
                                <option value="">----</option>
                                {% for genero in generos%}
                  
                                <option value="{{genero.id_genero}}">{{genero.genero}}</option>
                                {% endfor %}
                                
                              </select>
                        </div>
                    </div>

                    <div class="item form-group">
                        <label for="referencia" class="col-form-label col-md-3 col-sm-3 label-align">Tipo de Sangre</label>
                        <div class="col-md-8 col-sm-8">
                            <select name="sangre_editar" id="sangre_editar" class="form-control">
                                <option value="">----</option>
                                <option value="A+">A+</option>
                                <option value="A-">A-</option>
                                <option value="B+">B+</option>
                                <option value="B-">B-</option>
                                <option value="AB+">AB+</option>
                                <option value="AB-">AB-</option>
                                <option value="O+">O+</option>
                                <option value="O-">O-</option>
                              </select>
                        </div>
                    </div>

                    <div class="item form-group">
                        <label for="referencia" class="col-form-label col-md-3 col-sm-3 label-align">Alergias</label>
                        <div class="col-md-8 col-sm-8">
                            <input id="alergias" name="alergias" class="form-control" type="text"  required>
                        </div>
                    </div>
                    <input id="id_usuario" class="form-control" type="hidden" name="id_usuario"  >

                    <!-- <div class="item form-group">
                        <label for="middle-name" class="col-form-label col-md-3 col-sm-3 label-align">Usuario<span
                                class="required">*</span></label>
                        <div class="col-md-8 col-sm-8 ">
                            <input id="usuario" class="form-control" type="text" name="usuario" readonly
                                value="{{ user.first_name }} {{ user.last_name }}">
                            
                        </div>
                    </div> -->

                    
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>
</div>



<script>
    $(document).ready(function() {
        // Cuando el modal se va a mostrar
        $('#editModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget);  // El botón que abrió el modal
            var id_empleo = button.data('id');  // Obtener el ID del empleo

            // Realizar una solicitud AJAX para obtener los datos
            $.ajax({
                url: '/dato_empleados/' + id_empleo + '/',  // URL de la vista que maneja la obtención de datos
                method: 'GET',
                success: function(data) {
                    $('#id_datos').val(data.id_datos);
                    $('#carnet_editar').val(data.ci);
                    $('#expedido_editar').val(data.expedido);
                    $('#nombres').val(data.nombre);
                    $('#ap_paterno_editar').val(data.ap_paterno);
                    $('#ap_materno_editar').val(data.ap_materno);
                    $('#fecha_registro_editar').val(data.fecha_nacimiento);
                    $('#correo').val(data.correo);
                    $('#alergias').val(data.alergias);
                    $('#id_usuario').val(data.id_usuario);
                    $('#civil').val(data.estado_civil);
                    $('#genero_editar').val(data.genero);
                    $('#sangre_editar').val(data.tipo_sangre);
                   

                    // Mostrar el estado en el modal: activo o inactivo
                    if (data.estado) {
                        $('#estado_empleado').html('<li class="fa fa-check fa-2x" style="color: blue;"></li>');
                    } else {
                        $('#estado_empleado').html('<li class="fa fa-times fa-2x" style="color: red;"></li>');
                    }
                },
                error: function(xhr, errmsg, err) {
                    console.log("Error: " + errmsg);
                }
            });
        });
    });
</script>
{% endblock %}
